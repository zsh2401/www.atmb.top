(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{657:function(t,e,a){"use strict";a.r(e);var l=a(6),s=Object(l.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[a("strong",[t._v("本文转载自 "),a("a",{attrs:{href:"https://www.evil42.com/index.php/archives/17/",target:"_blank",rel:"noopener noreferrer"}},[t._v("evil42.com"),a("OutboundLink")],1),t._v(" ，已获得原作者授权。")])]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("在开始处理之前有一些东西了解一下还是有好处的，不然纯粹去打命令却还不知道它是干嘛的。")]),t._v(" "),a("h3",{attrs:{id:"说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#说明"}},[t._v("#")]),t._v(" 说明")]),t._v(" "),a("p",[t._v("Captive Portal是安卓5引入的一种检测网络是否正常连接的机制，制作的非常有创意，通过HTTP返回的状态码是否是204来判断是否成功，如果访问得到了200带网页数据，那你就可能处在一个需要登录验证才能上网的环境里，比如说校园网，再比如说一些酒店提供的客户才能免费使用的WiFi（其实是通过DNS劫持实现的），如果连接超时（根本就连接不上）就在WiFi图标和信号图标上加一个标志，安卓5和6是叹号，安卓7改成一个叉了。只不过默认访问的是谷歌自家的验证服务器，然而由于你懂的原因，就算你连接上了网络也连不上这个服务器... 嗯...那其实还是没有连接上网络嘛... 噫....")]),t._v(" "),a("p",[t._v("谷歌设计了一个开关来控制是否启用这个特性，同时也提供了一个变量来控制待验证的服务器地址，国内的修改版ROM通常都改成了高通中国的地址，还有一些ROM设计了代码在重启的时候恢复这个设置，不知道是出于什么目的。")]),t._v(" "),a("p",[t._v("没更新7.0的时候，一直用小狐狸的"),a("a",{attrs:{href:"http://www.coolapk.com/apk/org.foxteam.noisyfox.noexclamation",target:"_blank",rel:"noopener noreferrer"}},[t._v("叹号杀手"),a("OutboundLink")],1),t._v("，很不错的应用，可惜当时他已经很久不更新了，当时安卓N不能用，后来自己做了个小工具，想了想就干脆上架酷安吧，也能帮助大家，这样有了"),a("a",{attrs:{href:"http://www.coolapk.com/apk/tech.evlsoc.captivemgr",target:"_blank",rel:"noopener noreferrer"}},[t._v("CaptiveMgr工具"),a("OutboundLink")],1),t._v("，这分明就是个没有名字的名字嘛...根本就是foo, bar一样...好像也没什么好叫的了？现在代码还比较乱，要是哪天有空把这堆代码整理出来就开源了算了，毕竟纯粹体力活。")]),t._v(" "),a("p",[t._v("具体的原理不在这里写了，这里主要写如何去掉叹号或者叉标志。")]),t._v(" "),a("p",[t._v("如果有root权限直接用"),a("a",{attrs:{href:"http://www.coolapk.com/apk/tech.evlsoc.captivemgr",target:"_blank",rel:"noopener noreferrer"}},[t._v("我这个工具"),a("OutboundLink")],1),t._v("算了，比较方便，毕竟用命令也就是检测一下系统然后代替执行命令而已嘛。\n(PS: 如果使用SS/SSR可以通过NAT模式让系统直接连接，其内部是通过iptables实现的)")]),t._v(" "),a("p",[t._v("如果没有root权限就得按下面操作了，做好配置以后重启WiFi和数据流量（打开再关闭飞行模式即可）就可以看到效果了。")]),t._v(" "),a("hr"),t._v(" "),a("p",[a("strong",[t._v("以下需要ADB调试，配置不赘述")])]),t._v(" "),a("h3",{attrs:{id:"_5-0-6-x教程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-0-6-x教程"}},[t._v("#")]),t._v(" 5.0 - 6.x教程")]),t._v(" "),a("p",[t._v("5和6还不支持HTTPS，直接修改即可")]),t._v(" "),a("ul",[a("li",[t._v("检测开关相关：")])]),t._v(" "),a("p",[t._v("先处理开关状态，这个变量删除就是默认开启的，删除操作随意执行，反正没影响，删除状态下获取这个变量会返回null。\n注意：如果关闭，则无法判断当前网络是否需要登录，无法自动弹出登录页面")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("//删除\nadb shell settings delete global captive_portal_server\n//禁用\nadb shell settings put global captive_portal_server "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n//查询状态\nadb shell settings get global captive_portal_server\n")])])]),a("ul",[a("li",[t._v("服务器地址相关：")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("//删除地址就可以恢复默认的谷歌服务器\nadb shell settings delete global captive_portal_server\n//设置一个可用地址（高通/V2EX都推荐）\nadb shell settings put global captive_portal_server captive.v2ex.co\n//查询当前地址\nadb shell settings get global captive_portal_server\n")])])]),a("h3",{attrs:{id:"_7-0-7-1教程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-0-7-1教程"}},[t._v("#")]),t._v(" 7.0 - 7.1教程")]),t._v(" "),a("p",[t._v("这两个版本相比5和6没有大的更改，只是默认连接服务器的时候使用HTTPS，但是提供了一个开关用以指定是否使用HTTPS")]),t._v(" "),a("ul",[a("li",[t._v("检测开关相关：")])]),t._v(" "),a("p",[t._v("同5.0 - 6.x")]),t._v(" "),a("ul",[a("li",[t._v("HTTPS开关相关：")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("//删除（直接删除则默认使用HTTPS）\nadb shell settings delete global captive_portal_use_https\n//禁用HTTPS（写1启用 写0禁用）\nadb shell settings put global captive_portal_use_https "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n//查询HTTPS开关状态\nadb shell settings get global captive_portal_use_https\n")])])]),a("ul",[a("li",[t._v("服务器地址相关："),a("br"),t._v("\n（如果启用了HTTPS需要先确定地址是否支持HTTPS）"),a("br"),t._v("\n同5.0 - 6.x")])]),t._v(" "),a("h3",{attrs:{id:"_7-1-1教程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-1教程"}},[t._v("#")]),t._v(" 7.1.1教程")]),t._v(" "),a("p",[t._v("这个版本把HTTPS和HTTP两个地址分开保存，并通过7.0加入的HTTPS开关来控制使用哪一个地址。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("检测开关相关："),a("br"),t._v("\n同5.0 - 6.x")])]),t._v(" "),a("li",[a("p",[t._v("HTTPS开关相关："),a("br"),t._v("\n同7.0 - 7.1")])]),t._v(" "),a("li",[a("p",[t._v("服务器地址相关：")])])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("//删除（删除默认用HTTPS）\nadb shell settings delete global captive_portal_https_url\nadb shell settings delete global captive_portal_http_url\n//分别修改两个地址\nadb shell settings put global captive_portal_http_url http://captive.v2ex.co/generate_204\nadb shell settings put global captive_portal_https_url https://captive.v2ex.co/generate_204\n")])])]),a("h3",{attrs:{id:"_7-1-2教程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-2教程"}},[t._v("#")]),t._v(" 7.1.2教程")]),t._v(" "),a("p",[t._v("此版本服务器地址判断逻辑相比7.1.1没有更改，但是检测的开关却变了。")]),t._v(" "),a("ul",[a("li",[t._v("检测开关：")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("//删除变量：（删除以后默认启用）\nadb shell settings delete global captive_portal_mode\n//关闭检测：\nadb shell settings put global captive_portal_mode "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n//查看当前状态：\nadb shell settings get global captive_portal_mode\n")])])]),a("ul",[a("li",[t._v("服务器地址相关（同7.1.1）：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("//删除（删除默认用HTTPS）\nadb shell settings delete global captive_portal_https_url\nadb shell settings delete global captive_portal_http_url\n//分别修改两个地址\nadb shell settings put global captive_portal_http_url http://captive.v2ex.co/generate_204\nadb shell settings put global captive_portal_https_url https://captive.v2ex.co/generate_204\n")])])]),a("h3",{attrs:{id:"_8-0-0和8-1-0和9-0-android-p-同上7-1-2-未做修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-0-0和8-1-0和9-0-android-p-同上7-1-2-未做修改"}},[t._v("#")]),t._v(" 8.0.0和8.1.0和9.0(Android P)同上7.1.2，未做修改")])])}),[],!1,null,null,null);e.default=s.exports}}]);